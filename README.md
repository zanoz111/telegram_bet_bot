# Telegram Бот для Ставок

Бот для создания ставок между двумя людьми в Telegram (@Inzaaa и @TROOLZ).

## Функционал

### Создание пари
- ✅ **Название пари**: Свободный ввод или готовые варианты (BO1, BO3, BO5)
- ✅ **Выбор матча**: 
  - Ввод через `vs` или пробел (`inz vs troolz` или `inz troolz`)
  - Кнопки быстрого выбора из 16 игроков
- ✅ **Коэффициенты**: Установка кэфов для каждой стороны
- ✅ **Сумма ставки**: Свободный ввод или готовые варианты (500/1000/1500/2000 ₽)

### Управление пари
- ✅ Принятие пари (выбор стороны)
- ✅ Редактирование коэффициентов и суммы
- ✅ Отмена открытых пари
- ✅ Указание результата матча
- ✅ Автоматический расчет выигрышей

### Статистика и просмотр
- ✅ Актуальные пари (открытые и принятые)
- ✅ История за 24 часа
- ✅ Статистика игроков с фильтрами (сегодня, 7 дней, 30 дней, все время)
- ✅ Сброс статистики

### Интерфейс
- ✅ Встроенное меню Telegram с командами
- ✅ Интерактивные кнопки для всех действий
- ✅ Визард создания пари (4 шага)

## Установка

1. Клонируйте репозиторий или скачайте файлы

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` в корне проекта:
```
BOT_TOKEN=your_telegram_bot_token_here
```

4. Получите токен бота:
   - Напишите [@BotFather](https://t.me/BotFather) в Telegram
   - Используйте команду `/newbot` для создания нового бота
   - Скопируйте полученный токен в файл `.env`

## Запуск

```bash
python bot.py
```

## Быстрый старт

### Через меню бота
1. Откройте бота в Telegram
2. Нажмите кнопку "Меню" (слева от поля ввода)
3. Выберите `/start` или `/create_match`

### Через команды
1. Отправьте `/start` боту
2. Используйте кнопки для навигации

## Создание пари (визард из 4 шагов)

### Шаг 0: Название пари
- Введите свое название или выберите кнопку (BO1/BO3/BO5)

### Шаг 1: Матч
- **Вариант 1**: Введите `inz vs troolz` или `inz troolz`
- **Вариант 2**: Выберите игроков из кнопок (2 клика)

### Шаг 2: Коэффициенты
- Введите два числа через пробел: `1.80 2.00`

### Шаг 3: Сумма ставки
- Введите сумму или выберите кнопку (500/1000/1500/2000 ₽)

## Основные команды

- `/start` - Главное меню
- `/create_match` - Создать пари

## Подробное руководство

Смотрите [USER_GUIDE.md](USER_GUIDE.md) для подробной инструкции по использованию всех функций бота.

## Структура проекта

```
.
├── bot.py                 # Основной файл бота
├── config.py              # Конфигурация (игроки, режимы)
├── constants.py           # Константы (список игроков, названия)
├── requirements.txt       # Зависимости
├── .env                  # Токен бота (создать самостоятельно)
├── bets.db               # База данных SQLite (создается автоматически)
├── README.md             # Документация проекта
├── USER_GUIDE.md         # Руководство пользователя
├── CHANGELOG.md          # История изменений
├── models/
│   ├── __init__.py
│   └── bet.py           # Модели данных (Bet, LedgerEntry)
├── handlers/
│   ├── __init__.py
│   ├── start.py         # Обработчик /start и главное меню
│   └── bet_handlers.py  # Обработчики пари (создание, принятие, результаты)
└── database/
    ├── __init__.py
    └── db.py            # Работа с базой данных (SQLite)
```

## База данных

Бот использует SQLite для хранения данных. База данных создается автоматически при первом запуске.

### Таблица `bets`
- ID пари
- Maker (создатель) и Taker (принявший)
- Название пари
- Игроки (playerA, playerB)
- Коэффициенты (oddsA, oddsB)
- Сумма ставки
- Выбранная сторона
- Статус (DRAFT, OPEN, TAKEN, FINISHED, CANCELED)
- Результат матча
- Выигрыши/проигрыши

### Таблица `ledger`
- История всех транзакций
- Используется для расчета статистики
- Связь с таблицей `bets`

### Автоматическая миграция
При обновлении бота база данных автоматически обновляется (добавление новых полей).

## История изменений

Смотрите [CHANGELOG.md](CHANGELOG.md) для подробной истории версий.

## Особенности

### Тестовый режим
Установите `TEST_MODE=true` в `.env` для тестирования на одном аккаунте.

### Формулы расчета
- **Taker выиграл**: `Taker +S*(O-1)`, `Maker -S*(O-1)`
- **Taker проиграл**: `Taker -S`, `Maker +S`
- **VOID**: `Taker 0`, `Maker 0`

Где:
- `S` - сумма ставки
- `O` - коэффициент выбранной стороны

## Поддерживаемые игроки

ash, AGENT, cYphER, rapha, pavel, k1llsen, Spart1e, baksteen, prox1mo, SV, swex, cherepoff, RAISY, fog, fire_bot, ARSENY

## Лицензия

MIT
